<div class="project-container">
  @if (showAddTask) {
    <app-add-task-form
      [projectID]="projectID"
      (close)="showAddTask = false"
      (created)="onTaskCreated()">
    </app-add-task-form>
  } @else {
    <button class="add-task-btn" (click)="showAddTask = true">Add task</button>
  }

  @if (showEditTask && selectedTask) {
    <app-edit-task-form 
      [task]="selectedTask"
      (close)="closeEditTask()"
      (updated)="onTaskUpdated()">
    </app-edit-task-form>
  }

  @if (showTaskDeleteConfirmation && taskToDelete) {
    <app-delete-task-confirmation
      [taskId]="taskToDelete.id_task"
      [taskTitle]="taskToDelete.title"
      (close)="closeDeleteTask()"
      (deleted)="onTaskDeleted()">
    </app-delete-task-confirmation>
  }

  @if (isLoading) {

    <div class="loading">Loading tasks...</div>

  } @else {

    <div class="board">

      @for (col of columnOrder; track col.id) {

        <div class="column">

          <h3 class="column-title">{{ col.title }}</h3>

          @if (columns[col.id].length === 0) {

            <div class="column-empty">No tasks</div>

          } @else {

            <div class="task-list">

              @for (task of columns[col.id]; track task.id_task) {

                <div class="task-card">

                  <h4 class="task-title">{{ task.task_title }}</h4>

                  <button
                    class="move-btn"
                    (click)="task.showMoveMenu = !task.showMoveMenu; $event.stopPropagation()">
                    ‚áÑ
                  </button>

                  @if (task.showMoveMenu) {
                    <div class="move-menu">
                      @for (target of columnOrder; track target.id) {
                        <button
                          (click)="moveTask(task, target.id); task.showMoveMenu = false">
                          {{ target.title }}
                        </button>
                      }
                    </div>
                  }

                  <button
                    class="edit-btn"
                    (click)="openEditTask(task); $event.stopPropagation()">
                    ‚úèÔ∏è
                  </button>

                  <button
                    class="delete-btn"
                    (click)="openDeleteTask(task); $event.stopPropagation()">
                    üóëÔ∏è
                  </button>

                  @if (task.description) {
                    <p class="task-description">{{ task.description }}</p>
                  }

                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>